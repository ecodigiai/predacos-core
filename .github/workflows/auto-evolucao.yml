name: Auto-EvoluÃ§Ã£o Predacos

on:
  schedule:
    # Executa a cada 6 horas
    - cron: '0 */6 * * *'
  workflow_dispatch:
    inputs:
      modo:
        description: 'Modo de evoluÃ§Ã£o'
        required: true
        default: 'analise'
        type: choice
        options:
          - analise
          - otimizacao
          - descoberta
          - aprendizado

jobs:
  analise-metricas:
    name: ğŸ“Š AnÃ¡lise de MÃ©tricas
    runs-on: ubuntu-latest
    if: github.event.inputs.modo == 'analise' || github.event_name == 'schedule'
    
    steps:
      - name: ğŸ“¥ Checkout cÃ³digo
        uses: actions/checkout@v4
      
      - name: ğŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: ğŸ“¦ Instalar dependÃªncias
        run: npm ci
      
      - name: ğŸ“Š Coletar mÃ©tricas
        run: |
          echo "Coletando mÃ©tricas do sistema..."
          node laboratorio/coletar-metricas.js || echo "Script de mÃ©tricas nÃ£o implementado"
        env:
          FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}
          NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
      
      - name: ğŸ“ˆ Analisar tendÃªncias
        run: |
          echo "Analisando tendÃªncias de evoluÃ§Ã£o..."
          node laboratorio/analisar-tendencias.js || echo "Script de anÃ¡lise nÃ£o implementado"

  otimizacao-codigo:
    name: âš¡ OtimizaÃ§Ã£o de CÃ³digo
    runs-on: ubuntu-latest
    if: github.event.inputs.modo == 'otimizacao'
    
    steps:
      - name: ğŸ“¥ Checkout cÃ³digo
        uses: actions/checkout@v4
      
      - name: ğŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: ğŸ“¦ Instalar dependÃªncias
        run: npm ci
      
      - name: âš¡ Identificar oportunidades
        run: |
          echo "Identificando oportunidades de otimizaÃ§Ã£o..."
          node services/agents/evolver-agent.js --modo otimizacao || echo "Evolver agent nÃ£o implementado"
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: ğŸ”§ Criar PR de otimizaÃ§Ã£o
        run: |
          echo "Criando PR com melhorias sugeridas..."
          node services/agents/builder-agent.js --tipo otimizacao || echo "Builder agent nÃ£o implementado"

  descoberta-tecnologias:
    name: ğŸ” Descoberta de Tecnologias
    runs-on: ubuntu-latest
    if: github.event.inputs.modo == 'descoberta'
    
    steps:
      - name: ğŸ“¥ Checkout cÃ³digo
        uses: actions/checkout@v4
      
      - name: ğŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: ğŸ“¦ Instalar dependÃªncias
        run: npm ci
      
      - name: ğŸ” Explorar novas tecnologias
        run: |
          echo "Explorando novas tecnologias e ferramentas..."
          node laboratorio/explorador-tecnologias.js || echo "Explorador nÃ£o implementado"
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
      
      - name: ğŸ§ª Testar integraÃ§Ãµes
        run: |
          echo "Testando novas integraÃ§Ãµes descobertas..."
          node laboratorio/testar-integracoes.js || echo "Testes de integraÃ§Ã£o nÃ£o implementados"

  aprendizado-continuo:
    name: ğŸ§  Aprendizado ContÃ­nuo
    runs-on: ubuntu-latest
    if: github.event.inputs.modo == 'aprendizado' || github.event_name == 'schedule'
    
    steps:
      - name: ğŸ“¥ Checkout cÃ³digo
        uses: actions/checkout@v4
      
      - name: ğŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: ğŸ“¦ Instalar dependÃªncias
        run: npm ci
      
      - name: ğŸ§  Processar aprendizado
        run: |
          echo "Processando dados de aprendizado..."
          node cerebro/sistema-aprendizado.js || echo "Sistema de aprendizado nÃ£o implementado"
        env:
          FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      
      - name: ğŸ“ Atualizar documentaÃ§Ã£o
        run: |
          echo "Atualizando documentaÃ§Ã£o com novos aprendizados..."
          node integracoes/notion-diario.js || echo "IntegraÃ§Ã£o Notion nÃ£o implementada"
        env:
          NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}

  relatorio-evolucao:
    name: ğŸ“‹ RelatÃ³rio de EvoluÃ§Ã£o
    runs-on: ubuntu-latest
    needs: [analise-metricas, aprendizado-continuo]
    if: always()
    
    steps:
      - name: ğŸ“Š Gerar relatÃ³rio
        run: |
          echo "==================================="
          echo "ğŸ“Š RELATÃ“RIO DE AUTO-EVOLUÃ‡ÃƒO"
          echo "==================================="
          echo "Data: $(date)"
          echo "Modo: ${{ github.event.inputs.modo || 'schedule' }}"
          echo ""
          echo "Status dos jobs:"
          echo "- AnÃ¡lise de MÃ©tricas: ${{ needs.analise-metricas.result }}"
          echo "- Aprendizado ContÃ­nuo: ${{ needs.aprendizado-continuo.result }}"
          echo ""
          echo "âœ… Ciclo de evoluÃ§Ã£o concluÃ­do!"
